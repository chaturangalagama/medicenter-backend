<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:sec="http://www.springframework.org/schema/security"
       xmlns="http://www.springframework.org/schema/beans"
       xmlns:mongo="http://www.springframework.org/schema/data/mongo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/data/mongo
       http://www.springframework.org/schema/data/mongo/spring-mongo-1.0.xsd
       http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.2.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <!--<import resource="spring-security.xml"/>-->
    <context:component-scan base-package="com.ilt.cms"/>
    <context:component-scan base-package="com.lippo"/>
    <mongo:repositories base-package="com.ilt.cms.repository" />
    <context:property-placeholder location="classpath:reporting.properties, classpath:messages_en.properties"/>
    <!--<import resource="reporting-repository.xml"/>-->

    <mvc:annotation-driven/>

    <sec:http auto-config='true'>
        <sec:csrf disabled="true"/>
        <!--<sec:intercept-url pattern="/webcontent/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/>-->
        <sec:intercept-url pattern="/images/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
        <sec:intercept-url pattern="/css/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
        <sec:intercept-url pattern="/js/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/>
        <sec:intercept-url pattern="/favicon.ico" access="IS_AUTHENTICATED_ANONYMOUSLY"/>

        <sec:intercept-url pattern="/" access="isAuthenticated()"/>
        <sec:intercept-url pattern="/2_daily_queue_list/**" access="ROLE_DAILY_QUEUE_LIST"/>
        <sec:intercept-url pattern="/3_daily_patient_register_report/**" access="ROLE_DAILY_PATIENT_REGISTER_REPORT"/>
        <sec:intercept-url pattern="/6_drug_dispensing_enquiry/**" access="ROLE_DRUG_DISPENSING_ENQUIRY"/>
        <sec:intercept-url pattern="/7_patient_treatment_records/**" access="ROLE_PATIENT_TREATMENT_RECORD"/>
        <sec:intercept-url pattern="/8_medical_certificate_report/**" access="ROLE_MEDICAL_CERTIFICATE_REPORT"/>
        <sec:intercept-url pattern="/10_patient_consultation_history/**" access="ROLE_PATIENT_CONSULTATION_HISTORY"/>
        <sec:intercept-url pattern="/21_pos_collection_summary/**" access="ROLE_POS_COLLECTION_SUMMARY"/>
        <sec:intercept-url pattern="/24_revenue_collection_report/**" access="ROLE_REVENUE_COLLECTION_REPORT"/>
        <sec:intercept-url pattern="/25_revenue_analysis_report/**" access="ROLE_REVENUE_ANALYSIS_REPORT"/>
        <sec:intercept-url pattern="/26_revenue_management_report/**" access="ROLE_REVENUE_MANAGEMENT_REPORT"/>
        <sec:intercept-url pattern="/27_private_corporate_patient_listing/**" access="ROLE_PRIVATE_CORPORATE"/>
        <sec:intercept-url pattern="/28_report_on_outstanding_bill_invoice/**"
                           access="ROLE_REPORT_ON_OUTSTANDING_BILL_INVOICE"/>
        <sec:intercept-url pattern="/29_weekly_monthly_revenue_report_by_clinic/**"
                           access="ROLE_WEEKLY_MONTHLY_REVENUE_REPORT_BY_CLINIC"/>
        <sec:intercept-url pattern="/30-ioc_patient.rptdesign/**" access="ROLE_IOC_PATIENT"/>
        <sec:intercept-url pattern="/33_corporate_revenue_summary/**" access="ROLE_PATIENT_REVENUE_SUMMARY"/>
        <sec:intercept-url pattern="/34_laboratory_service_report/**" access="ROLE_LABORATORY_SERVICE_REPORT"/>
        <sec:intercept-url pattern="/40_doctor_revenue_report/**" access="ROLE_DOCTOR_REVENUE_REPORT"/>
        <sec:intercept-url pattern="/41_report_on_treatment/**" access="ROLE_REPORT_ON_TREATMENT"/>
        <sec:intercept-url pattern="/43_report_on_procedure_category/**" access="ROLE_REPORT_ON_PROCEDURE_CATEGORY"/>
        <sec:intercept-url pattern="/45_doctors_patient_seen/**" access="ROLE_DOCTORS_PATIENT_SEEN"/>
        <sec:intercept-url pattern="/46_report_on_patient_referral/**" access="ROLE_REPORT_ON_PATIENT_REFERRAL"/>
        <sec:intercept-url pattern="/47_report_on_weekly_revenue_summary/**"
                           access="ROLE_REPORT_ON_WEEKLY_REVENUE_SUMMARY"/>
        <sec:intercept-url pattern="/48_report_on_revenue_summary/**" access="ROLE_REPORT_ON_REVENUE_SUMMARY"/>
        <sec:intercept-url pattern="/49_report_on_sms_utilization/**" access="ROLE_REPORT_ON_SMS_UTILIZATION"/>
        <sec:intercept-url pattern="/home" access="isAuthenticated()"/>
        <sec:intercept-url pattern="/transaction-report" access="isAuthenticated()"/>
        <sec:intercept-url pattern="/frameset?**" access="isAuthenticated()"/>
        <sec:access-denied-handler error-page="/access-denied.jsp"/>

        <sec:custom-filter ref="jwtAuthenticationFilter" position="CAS_FILTER"/>
    </sec:http>

    <sec:authentication-manager alias="authenticationManager">
        <sec:authentication-provider ref="jwtAuthenticationProvider"/>
        <!--<sec:authentication-provider ref="anonymousAuthenticationProvider"/>-->
    </sec:authentication-manager>

    <bean id="jwtAuthenticationProvider" class="com.ilt.cms.report.ui.sec.JwtAuthenticationProvider"/>

    <bean id="jwtAuthenticationFilter" class="com.ilt.cms.report.ui.sec.JwtAuthenticationFilter">
        <property name="authenticationManager" ref="authenticationManager"/>
        <property name="authenticationSuccessHandler" ref="jwtAuthenticationSuccessHandler"/>
    </bean>

    <!--<bean id="anonymousAuthFilter"-->
    <!--class="org.springframework.security.web.authentication.AnonymousAuthenticationFilter">-->
    <!--<constructor-arg value="anonymous"/>-->
    <!--</bean>-->

    <!--<bean id="anonymousAuthenticationProvider"-->
    <!--class="org.springframework.security.authentication.AnonymousAuthenticationProvider">-->
    <!--<constructor-arg value="anonymous"/>-->
    <!--</bean>-->

    <bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/views/"/>
        <property name="suffix" value=".jsp"/>
    </bean>

    <mvc:resources mapping="/resources/**" location="/resources/"/>
    <mvc:resources mapping="/webcontent/**" location="/webcontent/"/>

    <!--localization and internationalization starts here -->
    <bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="basename" value="classpath:messages_en"/>
        <property name="defaultEncoding" value="UTF-8"/>
    </bean>

    <!-- controller beans-->
    <!--<bean id="transactionController" class="com.ouelh.cms.report.ui.controller.TransactionController">-->
    <!--<property name="checkedColumns" ref="transactionCheckedColumns"/>-->
    <!--</bean>-->

    <!--<util:list id="transactionCheckedColumns" value-type="java.lang.String">-->
    <!--<value>transaction_id</value>-->
    <!--<value>msisdn</value>-->
    <!--<value>service_code</value>-->
    <!--<value>system_status_description</value>-->
    <!--</util:list>-->


    <bean id="transactionFormValidator" class="com.ilt.cms.report.ui.validator.TransactionFormValidator"
          p:maxDurationInDays="30"
          p:maxDurationInMinutes="10"
          p:maxPastRecordsInMonths="3"
          p:msisdnRegex="${transaction.report.msisdn.validation.regex}"/>


    <!--<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"-->
    <!--p:dataSource-ref="dataSource"/>-->

    <mongo:db-factory dbname="${mongodb.db}" host="${mongodb.ip}" port="${mongodb.port}"/>

    <bean id="mongoTemplate" class="org.springframework.data.mongodb.core.MongoTemplate">
        <constructor-arg name="mongoDbFactory" ref="mongoDbFactory"/>
    </bean>


    <bean id="birtReportConfiguration" class="com.ilt.cms.report.ui.report.BirtReportConfiguration">
        <property name="mySqlDriver" value="${jdbc.driver}"/>
        <property name="mySqlUrl" value="${jdbc.url}"/>
        <property name="mySqlUsername" value="${jdbc.username}"/>
        <property name="mySqlPassword" value="${jdbc.password}"/>
        <property name="noOfRowsPerPage" value="${reporting.number.of.rows.per.page}"/>
        <property name="reportLocation" value="report"/>
        <property name="reportCssLocation" value="resources/css/style.css"/>
        <property name="reportResourceLocation" value="resources/message/report-messages"/>
    </bean>

</beans>